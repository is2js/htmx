<div class="container" hx-target="this" hx-swap="outerHTML swap:.5s">
    <article class="post">
        <div class="header">
            <a href="{{ url_for('pic_users') }}">
                {% set avatar_url = post.user.image_url if post.user.image_url else url_for('static', path='images/default-user.png') %}
                <img src="{{ avatar_url }}" class="profile"
                     alt="{{ post.user.username }}"/>
            </a>
            <a href="{{ url_for('pic_users') }}">
                <div class="name">{{ post.user.username }}</div>
            </a>
            <div class="time">{{ post.updated_at | feed_time }} {% if post.created_at != post.updated_at -%}
                (수정됨){%- endif %}</div>
            {# https://icons.getbootstrap.com/?q= #}
            <div class="header-icons">
                {% if user and post.user.id == user.id %}
                    <a hx-get="{{ url_for('pic_hx_get_edit_form', post_id= post.id ) }}" style="cursor: pointer;">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a hx-delete="{{ url_for('pic_delete_post', post_id= post.id ) }}"
                       hx-confirm="정말 삭제하시겠습니까?"
                       style="cursor: pointer;"
                    >
                        <i class="bi bi-trash3-fill"></i>
                    </a>
                {% else %}

                {% endif %}
            </div>
        </div>
        <div class="contents">
            {% if post.image_url %}
                <img class="img-fluid" alt="100%x250" src="{{ url_for('uploads', path=post.image_url) }}">
            {% endif %}
            {# 추가 텍스트 post.content + tag #}
            {#<p class="fs-5 fw-bold mt-3 mb-10 px-4">{{ post.content }}</p>#}
            <div class="d-flex align-items-center gap-2 text-sm my-3 flex-wrap">
                {% for tag in post.tags %}
                    <a href="{{ url_for('pic_get_tag', tag_id=tag.id) }} "
                       class="btn btn-sm rounded-pill border-0 px-3 py-1"
                       style="background: linear-gradient(135deg, #3a8ffe 0%, #9658fe 100%); color: #fff; transition: background-color 0.3s, color 0.3s;"
                    >
                        {{ tag.name }}
                    </a>
                {% endfor %}
            </div>
        </div>
        <div class="icons">
            <div class="icons-left">
                <i class="bi bi-heart"></i>
                <i class="bi bi-chat"></i>
                <i class="bi bi-send"></i>
            </div>
            <div class="icons-right">
                <i class="bi bi-bookmark"></i>
            </div>
        </div>
        {% set comments = post.comments %}
        {% set comments_count = comments | length %}
        {# 좋아요 / 작성자 + 컨텐츠 #}
        <div class="pt-2 text-sm">
            <div class="d-block my-1 fs-6">
                <strong>{{ 123 }} 명</strong>이 좋아합니다.
            </div>
            <div class="d-flex flex-row gap-2">
                <strong class="d-inline">{{ post.user.username }}</strong>
                <p class="d-inline">{{ post.content }}</p>
            </div>
            {% if comments_count > 0 %}
                <button class="btn p-0">
                    {#<a href="{{ url_for('pic_show_comments', post_id= post.id )  }}"#}
                    <a hx-get="{{ url_for('pic_hx_show_comments', post_id= post.id ) }}"
                       hx-target="#dialog"
                       hx-swap="innerHTML"
                        class="text-decoration-none text-muted fs-6">
                        댓글 {{ comments_count }}개 전체 보기
                    </a>
                </button>
            {% endif %}
        </div>

        {# 댓글 최대 2개만 #}
{#        {% if comments_count > 0 %}#}
{#            {% include 'picstargram/post/partials/comments_div.html' %}#}
{#        {% endif %}#}

        {# 댓글 추가 form #}
        {% include 'picstargram/post/partials/comment_create_form.html' %}

    </article>
</div>